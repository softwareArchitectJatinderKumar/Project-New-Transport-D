<div class="transport-page">
  <header class="toolbar">
    <h2>Transports</h2>
    <div class="toolbar-controls">
      <div class="search-wrapper">
        <span class="search-icon">ğŸ”</span>
        <input class="search" placeholder="Search..." (input)="onSearchChange($event.target.value)" />
      </div>
        <button class="filter-toggle" (click)="filtersOpen = !filtersOpen" aria-expanded="{{filtersOpen}}">Filters â–¾</button>
      <button class="btn icon-only" (click)="openAddModal()" title="Add New Record">â•</button>
      <button class="btn icon-only" (click)="exportCurrent()" title="Export">ğŸ“¤</button>
    </div>
    <div class="user-bar">
      <ng-container *ngIf="currentUser; else guest">
        <span class="user">{{ currentUser.username }}</span>
        <button class="btn icon-only" (click)="logout()" title="Logout">ğŸšª</button>
      </ng-container>
      <ng-template #guest><span class="user">Not signed in</span></ng-template>
    </div>
  </header>

  <div class="meta">
    <div>Showing {{ filteredData.length }} records</div>
    <div>
      Size:
      <select (change)="$any($event.target).value && setPageSize($any($event.target).value)" [value]="pageSize">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="50">50</option>
        <option value="999999">All</option>
      </select>
    </div>
  </div>

  <!-- Responsive filter bar (mirrors home) -->
  <div class="filter-bar" [class.open]="filtersOpen">
    <div class="filter-row">
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterCrane" (change)="onFilterChange()" /> Crane</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterContainer" (change)="onFilterChange()" /> Container</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterFullLoads" (change)="onFilterChange()" /> Full Loads</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterGeneralFreight" (change)="onFilterChange()" /> General Freight</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterVehicle" (change)="onFilterChange()" /> Vehicle</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterRefrigerated" (change)="onFilterChange()" /> Refrigerated</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterUrgent" (change)="onFilterChange()" /> URGENT</label>
      <label class="filter-checkbox"><input type="checkbox" [(ngModel)]="filterSensitive" (change)="onFilterChange()" /> Sensitive Freight</label>
    </div>
  </div>

  <div class="load-banner" *ngIf="loadMessage">{{ loadMessage }}</div>


  <div class="table-wrap" *ngIf="rows().length > 0; else empty">
    <table>
      <thead>
        <tr>
          <th *ngFor="let c of columns()" (click)="toggleSort(c)" class="sortable">
            {{ c }}
            <span class="sort-indicator" *ngIf="sortColumn === c">{{ sortDirection === 'asc' ? 'â–²' : sortDirection === 'desc' ? 'â–¼' : '' }}</span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of rows(); let i = index">
          <td *ngFor="let c of columns()">{{ row[c] }}</td>
          <td class="actions">
            <ng-container *ngIf="currentUser; else signedOutActions">
              <button class="btn icon-only" (click)="openEditModal(i)" title="Edit">âœï¸</button>
              <button class="btn icon-only danger" (click)="deleteRow(i)" title="Delete">ğŸ—‘ï¸</button>
            </ng-container>
            <ng-template #signedOutActions>
              <span class="small muted">Sign in to edit</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination">
      <button class="btn icon-only" (click)="changePage(-1)" title="Previous">â—€</button>
      <span>{{ currentPage }}/{{ totalPages }}</span>
      <button class="btn icon-only" (click)="changePage(1)" title="Next">â–¶</button>
    </div>
  </div>

  <ng-template #empty>
    <div class="empty">No records found.</div>
  </ng-template>

  <!-- Modal editor -->
  <div class="modal-backdrop" *ngIf="modalOpen">
  <div class="modal-dialog" role="dialog" aria-modal="true">
    <header class="modal-header">
      <h3>{{ isAddMode ? 'Add Transport' : 'Edit Transport' }}</h3>
    </header>
      <div class="modal-body">
        <form class="modal-fields">
          <div class="field" *ngFor="let c of modalColumns()">
            <label>{{ c }}</label>
            <ng-container *ngIf="isFilterColumn(c); else textField">
              <label class="checkbox-inline"><input type="checkbox" [checked]="checkboxValue(c)" (change)="setCheckboxValue(c,$event.target.checked)" /> Yes</label>
            </ng-container>
            <ng-template #textField>
              <input [(ngModel)]="modalRow[c]" name="{{c}}" />
            </ng-template>
          </div>
        </form>
      </div>
      <footer class="modal-footer">
      <button class="btn icon-only" (click)="isAddMode ? saveAddModal() : saveModalEdit()" title="Save">ğŸ’¾</button>
      <button class="btn icon-only" (click)="closeEditModal()" title="Cancel">âœ–</button>
      </footer>
    </div>
  </div>
</div>
